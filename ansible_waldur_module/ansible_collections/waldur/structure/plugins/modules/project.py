#!/usr/bin/python
#
# THIS FILE IS AUTOGENERATED BY THE ANSIBLE MODULE GENERATOR - DO NOT EDIT
#
from ansible.module_utils.basic import AnsibleModule
from ansible_collections.waldur.structure.plugins.module_utils.waldur.crud_runner import (
    CrudRunner,
)

ANSIBLE_METADATA = {
    "metadata_version": "1.1",
    "status": ["preview"],
    "supported_by": "OpenNode",
}

DOCUMENTATION = """
---
module: project
short_description: Manage project resources.
description: 'When the resource already exists, the following fields can be updated: backend_id, customer, description, end_date, grace_period_days, image, is_industry, kind, name, oecd_fos_2007_code, slug, staff_notes, start_date, type.'
author: Waldur Team
options:
  access_token:
    description: An access token.
    required: true
    type: str
    no_log: true
  api_url:
    description: Fully qualified URL to the API.
    required: true
    type: str
  state:
    description: Should the resource be present or absent.
    choices:
    - present
    - absent
    default: present
    type: str
  wait:
    description: A boolean value that defines whether to wait for the async action to complete.
    default: true
    type: bool
  timeout:
    description: The maximum number of seconds to wait for the async action to complete.
    default: 600
    type: int
  interval:
    description: The interval in seconds for polling the async action status.
    default: 20
    type: int
  name:
    description: The name of the project.
    type: str
    required: true
  customer:
    description: The name or UUID of the parent customer for filtering.
    type: str
    required: false
  slug:
    type: str
    required: false
    description: URL-friendly identifier. Only editable by staff users.
  description:
    type: str
    required: false
    description: Project description (HTML content will be sanitized)
  type:
    type: str
    required: false
    description: The name or UUID of the type. Type
  backend_id:
    type: str
    required: false
    description: Backend id
  start_date:
    type: str
    required: false
    description: Project start date. Cannot be edited after the start date has arrived.
  end_date:
    type: str
    required: false
    description: Project end date. Setting this field requires DELETE_PROJECT permission.
  oecd_fos_2007_code:
    type: dict
    required: false
    description: Oecd fos 2007 code
    choices:
    - '1.1'
    - '1.2'
    - '1.3'
    - '1.4'
    - '1.5'
    - '1.6'
    - '1.7'
    - '2.1'
    - '2.2'
    - '2.3'
    - '2.4'
    - '2.5'
    - '2.6'
    - '2.7'
    - '2.8'
    - '2.9'
    - '2.10'
    - '2.11'
    - '2.12'
    - '3.1'
    - '3.2'
    - '3.3'
    - '3.4'
    - '3.5'
    - '4.1'
    - '4.2'
    - '4.3'
    - '4.4'
    - '4.5'
    - '5.1'
    - '5.2'
    - '5.3'
    - '5.4'
    - '5.5'
    - '5.6'
    - '5.7'
    - '5.8'
    - '5.9'
    - '6.1'
    - '6.2'
    - '6.3'
    - '6.4'
    - '6.5'
    - ''
  is_industry:
    type: bool
    required: false
    description: Is industry
  image:
    type: str
    required: false
    description: Image
  kind:
    type: str
    required: false
    description: Kind
    choices:
    - default
    - course
    - public
  staff_notes:
    type: str
    required: false
    description: Internal notes visible only to staff and support users (HTML content will be sanitized)
  grace_period_days:
    type: int
    required: false
    description: Number of extra days after project end date before resources are terminated. Overrides customer-level setting.
requirements:
- python >= 3.9

"""

EXAMPLES = """
- name: Create a new project (OecdFos2007CodeEnum)
  hosts: localhost
  tasks:
  - name: Add project (OecdFos2007CodeEnum)
    waldur.structure.project:
      state: present
      access_token: b83557fd8e2066e98f27dee8f3b3433cdc4183ce
      api_url: https://waldur.example.com
      name: My-Awesome-project
      slug: string-value
      customer: Customer name or UUID
      description: A sample description created by Ansible.
      type: Type name or UUID
      backend_id: a1b2c3d4-e5f6-7890-abcd-ef1234567890
      start_date: '2023-10-01'
      end_date: '2023-10-01'
      oecd_fos_2007_code: {}
      is_industry: true
      image: string-value
      kind: default
      staff_notes: string-value
      grace_period_days: 123
- name: Create a new project (BlankEnum)
  hosts: localhost
  tasks:
  - name: Add project (BlankEnum)
    waldur.structure.project:
      state: present
      access_token: b83557fd8e2066e98f27dee8f3b3433cdc4183ce
      api_url: https://waldur.example.com
      name: My-Awesome-project
      slug: string-value
      customer: Customer name or UUID
      description: A sample description created by Ansible.
      type: Type name or UUID
      backend_id: a1b2c3d4-e5f6-7890-abcd-ef1234567890
      start_date: '2023-10-01'
      end_date: '2023-10-01'
      oecd_fos_2007_code: {}
      is_industry: true
      image: string-value
      kind: default
      staff_notes: string-value
      grace_period_days: 123
- name: Create a new project (NullEnum)
  hosts: localhost
  tasks:
  - name: Add project (NullEnum)
    waldur.structure.project:
      state: present
      access_token: b83557fd8e2066e98f27dee8f3b3433cdc4183ce
      api_url: https://waldur.example.com
      name: My-Awesome-project
      slug: string-value
      customer: Customer name or UUID
      description: A sample description created by Ansible.
      type: Type name or UUID
      backend_id: a1b2c3d4-e5f6-7890-abcd-ef1234567890
      start_date: '2023-10-01'
      end_date: '2023-10-01'
      oecd_fos_2007_code: {}
      is_industry: true
      image: string-value
      kind: default
      staff_notes: string-value
      grace_period_days: 123
- name: Remove an existing project
  hosts: localhost
  tasks:
  - name: Remove project
    waldur.structure.project:
      state: absent
      name: My-Awesome-project
      access_token: b83557fd8e2066e98f27dee8f3b3433cdc4183ce
      api_url: https://waldur.example.com

"""

RETURN = """
resource:
  description: The state of the project after the operation.
  type: dict
  returned: on success
  contains:
    url:
      description: URL URL
      type: str
      returned: always
      sample: https://api.example.com/api/url/a1b2c3d4-e5f6-7890-abcd-ef1234567890/
    uuid:
      description: UUID
      type: str
      returned: always
      sample: a1b2c3d4-e5f6-7890-abcd-ef1234567890
    name:
      description: Name
      type: str
      returned: always
      sample: My-Awesome-Resource
    slug:
      description: URL-friendly identifier. Only editable by staff users.
      type: str
      returned: always
      sample: string-value
    customer:
      description: Customer URL
      type: str
      returned: always
      sample: https://api.example.com/api/customer/a1b2c3d4-e5f6-7890-abcd-ef1234567890/
    customer_uuid:
      description: Customer UUID
      type: str
      returned: always
      sample: a1b2c3d4-e5f6-7890-abcd-ef1234567890
    customer_name:
      description: Customer name
      type: str
      returned: always
      sample: Big Corp Inc.
    customer_slug:
      description: Customer slug
      type: str
      returned: always
      sample: string-value
    customer_native_name:
      description: Customer native name
      type: str
      returned: always
      sample: string-value
    customer_abbreviation:
      description: Customer abbreviation
      type: str
      returned: always
      sample: string-value
    description:
      description: Project description (HTML content will be sanitized)
      type: str
      returned: always
      sample: A sample description created by Ansible.
    customer_display_billing_info_in_projects:
      description: Customer display billing info in projects
      type: bool
      returned: always
      sample: true
    created:
      description: Created
      type: str
      returned: always
      sample: '2023-10-01T12:00:00Z'
    type:
      description: Type URL
      type: str
      returned: always
      sample: https://api.example.com/api/type/a1b2c3d4-e5f6-7890-abcd-ef1234567890/
    type_name:
      description: Type name
      type: str
      returned: always
      sample: string-value
    type_uuid:
      description: Type UUID
      type: str
      returned: always
      sample: a1b2c3d4-e5f6-7890-abcd-ef1234567890
    backend_id:
      description: Backend ID
      type: str
      returned: always
      sample: a1b2c3d4-e5f6-7890-abcd-ef1234567890
    start_date:
      description: Project start date. Cannot be edited after the start date has arrived.
      type: str
      returned: always
      sample: '2023-10-01'
    end_date:
      description: Project end date. Setting this field requires DELETE_PROJECT permission.
      type: str
      returned: always
      sample: '2023-10-01'
    end_date_requested_by:
      description: End date requested by URL
      type: str
      returned: always
      sample: https://api.example.com/api/users/a1b2c3d4-e5f6-7890-abcd-ef1234567890/
    oecd_fos_2007_code:
      description: Oecd fos 2007 code
      type: str
      returned: always
      sample: null
    oecd_fos_2007_label:
      description: Human-readable label for the OECD FOS 2007 classification code
      type: str
      returned: always
      sample: string-value
    is_industry:
      description: Is industry
      type: bool
      returned: always
      sample: true
    image:
      description: Image URL
      type: str
      returned: always
      sample: https://api.example.com/api/image/a1b2c3d4-e5f6-7890-abcd-ef1234567890/
    resources_count:
      description: Number of active resources in this project
      type: int
      returned: always
      sample: 123
    max_service_accounts:
      description: Maximum number of service accounts allowed
      type: int
      returned: always
      sample: 123
    kind:
      description: Kind
      type: str
      returned: always
      sample: default
    is_removed:
      description: Is removed
      type: bool
      returned: always
      sample: true
    termination_metadata:
      description: Metadata about project termination (read-only)
      type: str
      returned: always
      sample: null
    staff_notes:
      description: Internal notes visible only to staff and support users (HTML content will be sanitized)
      type: str
      returned: always
      sample: string-value
    grace_period_days:
      description: Number of extra days after project end date before resources are terminated. Overrides customer-level setting.
      type: int
      returned: always
      sample: 123
    project_credit:
      description: Project credit
      type: float
      returned: always
      sample: 123.45
    marketplace_resource_count:
      description: Marketplace resource count
      type: dict
      returned: always
      sample: {}
    billing_price_estimate:
      description: Billing price estimate
      type: dict
      returned: always
      sample: {}
      contains:
        total:
          description: Total
          type: str
          returned: always
          sample: '12.34'
        current:
          description: Current
          type: str
          returned: always
          sample: '12.34'
        tax:
          description: Tax
          type: str
          returned: always
          sample: '12.34'
        tax_current:
          description: Tax current
          type: str
          returned: always
          sample: '12.34'
commands:
  description: A list of HTTP requests that were made (or would be made in check mode) to execute the task.
  type: list
  returned: when changed
  elements: dict
  contains:
    method:
      description: The HTTP method used (e.g., POST, PATCH, DELETE).
      type: str
      sample: POST
    url:
      description: The fully qualified URL of the API endpoint.
      type: str
      sample: https://api.example.com/api/projects/
    description:
      description: A human-readable summary of the command's purpose.
      type: str
      sample: Create new project
    body:
      description: The JSON payload sent with the request. Only present for methods with a body.
      type: dict
      returned: if applicable
      sample:
        name: My-Awesome-Project

"""

ARGUMENT_SPEC = {
    "access_token": {"type": "str", "no_log": True, "required": True},
    "api_url": {"type": "str", "required": True},
    "state": {"type": "str", "choices": ["present", "absent"], "default": "present"},
    "wait": {"type": "bool", "default": True},
    "timeout": {"type": "int", "default": 600},
    "interval": {"type": "int", "default": 20},
    "name": {"type": "str", "required": True},
    "customer": {"type": "str"},
    "slug": {"type": "str"},
    "description": {"type": "str"},
    "type": {"type": "str"},
    "backend_id": {"type": "str"},
    "start_date": {"type": "str"},
    "end_date": {"type": "str"},
    "oecd_fos_2007_code": {
        "type": "dict",
        "choices": [
            "1.1",
            "1.2",
            "1.3",
            "1.4",
            "1.5",
            "1.6",
            "1.7",
            "2.1",
            "2.2",
            "2.3",
            "2.4",
            "2.5",
            "2.6",
            "2.7",
            "2.8",
            "2.9",
            "2.10",
            "2.11",
            "2.12",
            "3.1",
            "3.2",
            "3.3",
            "3.4",
            "3.5",
            "4.1",
            "4.2",
            "4.3",
            "4.4",
            "4.5",
            "5.1",
            "5.2",
            "5.3",
            "5.4",
            "5.5",
            "5.6",
            "5.7",
            "5.8",
            "5.9",
            "6.1",
            "6.2",
            "6.3",
            "6.4",
            "6.5",
            "",
        ],
    },
    "is_industry": {"type": "bool"},
    "image": {"type": "str"},
    "kind": {"type": "str", "choices": ["default", "course", "public"]},
    "staff_notes": {"type": "str"},
    "grace_period_days": {"type": "int"},
}

RUNNER_CONTEXT = {
    "resource_type": "project",
    "check_url": "/api/projects/",
    "check_filter_keys": {"customer": "customer"},
    "name_query_param": "name_exact",
    "list_path": "/api/projects/",
    "create_path": "/api/projects/",
    "destroy_path": "/api/projects/{uuid}/",
    "update_path": "/api/projects/{uuid}/",
    "required_for_create": ["customer", "name"],
    "model_param_names": [
        "customer",
        "type",
        "backend_id",
        "description",
        "end_date",
        "grace_period_days",
        "image",
        "is_industry",
        "kind",
        "name",
        "oecd_fos_2007_code",
        "slug",
        "staff_notes",
        "start_date",
    ],
    "path_param_maps": {},
    "update_fields": [
        "backend_id",
        "customer",
        "description",
        "end_date",
        "grace_period_days",
        "image",
        "is_industry",
        "kind",
        "name",
        "oecd_fos_2007_code",
        "slug",
        "staff_notes",
        "start_date",
        "type",
    ],
    "update_actions": {},
    "resolvers": {
        "customer": {
            "url": "/api/customers/",
            "error_message": None,
            "filter_by": [],
            "name_query_param": "name_exact",
        },
        "type": {
            "url": "/api/project-types/",
            "error_message": None,
            "filter_by": [],
            "name_query_param": "name_exact",
        },
    },
    "resolver_order": ["customer", "type"],
    "resource_detail_path": "/api/projects/{uuid}/",
}


def main():
    """Main execution entrypoint for the Ansible module."""
    module = AnsibleModule(
        argument_spec=ARGUMENT_SPEC,
        supports_check_mode=True,
    )
    runner = CrudRunner(module, RUNNER_CONTEXT)
    runner.run()


if __name__ == "__main__":
    main()
